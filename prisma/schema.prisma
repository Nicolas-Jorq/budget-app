generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String        @id @default(cuid())
  email        String        @unique
  name         String
  password     String
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  budgets      Budget[]
  transactions Transaction[]
  savingsGoals SavingsGoal[]

  @@map("users")
}

model Budget {
  id           String        @id @default(cuid())
  name         String
  amount       Decimal       @db.Decimal(10, 2)
  spent        Decimal       @default(0) @db.Decimal(10, 2)
  category     String
  userId       String
  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  transactions Transaction[]
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt

  @@map("budgets")
}

model Transaction {
  id             String        @id @default(cuid())
  description    String
  amount         Decimal       @db.Decimal(10, 2)
  type           String        // 'income' or 'expense'
  category       String
  date           DateTime
  budgetId       String?
  budget         Budget?       @relation(fields: [budgetId], references: [id], onDelete: SetNull)
  userId         String
  user           User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  contributions  Contribution[]
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt

  @@map("transactions")
}

// Savings Goals System
enum GoalType {
  EMERGENCY_FUND
  BABY
  HOUSE
  VEHICLE
  VACATION
  EDUCATION
  RETIREMENT
  CUSTOM
}

model SavingsGoal {
  id            String         @id @default(cuid())
  name          String
  type          GoalType
  targetAmount  Decimal        @db.Decimal(12, 2)
  currentAmount Decimal        @default(0) @db.Decimal(12, 2)
  deadline      DateTime?
  priority      Int            @default(1)  // 1 = highest priority
  icon          String?
  color         String?
  metadata      Json?          // Flexible storage for type-specific data
  isCompleted   Boolean        @default(false)
  userId        String
  user          User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  contributions Contribution[]
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt

  @@map("savings_goals")
}

model Contribution {
  id            String       @id @default(cuid())
  amount        Decimal      @db.Decimal(10, 2)
  note          String?
  goalId        String
  goal          SavingsGoal  @relation(fields: [goalId], references: [id], onDelete: Cascade)
  transactionId String?
  transaction   Transaction? @relation(fields: [transactionId], references: [id], onDelete: SetNull)
  createdAt     DateTime     @default(now())

  @@map("contributions")
}
